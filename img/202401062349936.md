

## 概述

> `链路`
>
> * 是从一个结点到相邻结点的一段物理线路，中间没有任何其他的交换结点
> * 一条链路只是一条通路的一个组成部分
> * 或物理链路
>
> `数据链路`
>
> * 则是在链路基础上增加了一些必要的硬件（如网络适配器）和软件（如协议的实现）
> * 或逻辑链路

  ![数据链路层面帧的流动](  images\数据链路层面帧的流动.png)

> 从数据链路层上，帧的传输可以看成是在4段不同的链路上的通信组成的
>
> *  主机H1到主机H2所经过的网络可以是多种不同类型的
> * 不同的链路层可能采用不同的数据链路层协议

### 数据链路层使用的信道

> * 点对点信道
> * 广播信道
>   * 一对多的广播通信
>   * 必须使用专用的共享信道协议来协调这些主机的数据发送

![数据链路层使用的信道](  images\数据链路层使用的信道.png)

> 局域网属于数据链路层
>
> * 局域网虽然是葛网络。但是我们并不把局域网放在网络层中讨论，这是因为在网络层要讨论的是多个网络互联的问题，是讨论分组怎么从一个网络，通过路由器，转发到另一个网络
> * 而在同一个局域网内，分组怎么从一台主机传送到另一台主机，但并不经由路由器转发

## 三个重要问题

> 数据链路层传送的协议数据单元式帧
>
> * 以下三个问题都是在点对点信道的数据链路层来举例的

### 分装成帧

> * 封装成帧（framing）就是在一段数据的前后分别添加尾部和首部，然后就构成了一个帧
> * 尾部和首部主要作用就是帧定界

![封装成帧](  images\封装成帧.png)

**帧的数据部分长度**

> * 为了提高帧的传输效率，应当使帧的数据部分的长度尽可能大些
> * 考虑到差错控制等多种因素，每一种数据链路层协议都规定了帧的数据部分的长度上限，即最大传送单元MTU（Maximum Transfer Unit11）

### 差错控制

> 在传输过程中可能产生比特差错：1可能变0,0可能变1

![差错控制](  images\差错控制.png)

### 可靠传输

> * 接收方主机收到有误码的帧后，是不会接受该帧的，会将他丢弃
> * 如果数据链路层向其上层提供的是不可靠服务，那么丢弃就丢弃了，不会有其他措施
> * 如果数据链路层向其上层提供的是可靠服务，那就还需要其他措施，来确保接收方主机还可以重新收到被丢弃的这个帧的正确副本
>   * 尽管误码是不能完全避免的，但能实现发送方发送什么，接收方就能收到什么，就称为可靠传输

## 广播信道的问题

> * 如图所示，主机A，B，C，D，E通过一根总线进行互连，主机A要给主机C发送数据，代表帧的信号会通过总线传输到总线上的其他各主机，那么主机B，D，E如何知道所收到的帧不是发送给她们的，主机C如何知道发送的帧是发送给自己的
> * 就可以用编址（地址）来解决
> * 将帧的目的地址添加在帧中一起传输

![广播信道的传输寻址问题](  images\广播信道的传输寻址问题.png)

![广播信道的传输寻址问题1](  images\广播信道的传输寻址问题1.png)

### 数据碰撞

![数据碰撞](  images\数据碰撞.png)

> * 随着技术的发展，在有线（局域网）领域使用点对点链路和链路层交换机的交换式局域网取代了共享式局域网
>
> * 在无线局域网中仍使用的是共享信道技术

##    封装成帧

> 封装成帧是指数据链路层给上层交付的协议数据单元添加帧头和帧尾使之成为帧
>
> 首部和尾部的一个重要作用就是进行帧定界
>
> * 最大传送单元MTU（Maximum Transfer Unit）规定了所能传送的帧的数据部分长度上限
>
> 用控制字符作为帧定界符
>
> * 控制字符SOH，表示帧的首部开始
> * 控制字符EOT，表示帧的结束

![帧头帧尾包含的信息](  images\帧头帧尾包含的信息.png)

> 发送方的数据链路层将上层交付下来的协议数据单元封装成帧后，还要通过物理层，将构成帧的各比特，转换为电信号交给传输媒体，那么接收方的数据链路层如何从物理层交付的比特流中提取出一个个帧？
>
> * 答：需要帧头和帧尾做帧定界

![帧定界](  images\帧定界.png)

> 但不是每一种数据链路层协议的帧都包含有帧定界标志

![前导码](  images\前导码.png)

> 前导码
>
> * 前同步码：作用是使接受方的时钟同步
> * 帧开始定界符：表明其后面紧跟着的就是MAC帧

> 另外以太网还规定了帧间间隔为96比特时间，因此，MAC帧不需要帧救赎定界符

![帧间间隔](  images\帧间间隔.png)

## 透明传输

> 指数据链路层对上层交付的传输数据没有任何限制，好像数据链路层不存在一样
>
> * 帧界定标志也就是葛特定数据值，如果在上层交付的协议数据单元中，恰好也包含这个特定数值，接收方就不能正确接收
> * 所以数据链路层应该对上层交付的数据有限制，其内容不能包含帧定界符的值

**解决透明传输的问题**

> * 面向字节的物理链路使用字节填充（byte stuffing）或字符填充（character stuffing），面向比特的物理链路使用比特填充的方法实现透明传输
> * 发送端的数据链路层在数据中出现控制字符“SOH”或“EOT”的前面插入一个转义字符“ESC”（其十六进制编码是1B）
> * 接收端的数据链路层在将数据送往网络层之前删除插入的转义字符
> * 如果转义字符也出现数据当中，那么应在转义字符前面插入一个转义字符ESC。当接收端收到连续的两个转义字符时，就删除其中前面的一个

![透明传输解决方法](  images\透明传输解决方法.png)

## 差错检测

> 实际的通信链路都不是理想的，比特在传输过程中可能会产生差错：1可能变成0，0也可能变成1，这称为比特差错

> * 在一段时间内，传输错误的比特站所传输比特总数的比率称为误码率BER（Bit Error Rate）
> * 使用差错检测码来检测数据在传输过程中是否产生了比特差错，是数据链路层所要解决的重要问题之一  

![差错检测码](  images\差错检测码.png)

### 奇偶校验

> 在待发送的数据后面添一位奇偶校验位，使整个数据（包括所添加的校验位在内）中“1”的个数为奇数（奇校验）或偶数（偶校验）
>
> * 如果有奇数个位产生误码，则奇偶性发生变化，可以检查出误码
> * 如果偶数个位发生误码，则奇偶性不发生变化，不能检查出误码（漏检）

![奇偶校验](  images\奇偶校验.png)

### 循环冗余校验CRC（Cyclic Redundancy Check）

> * 收发双方约定好一个生成多项式G（x）
> * 发送方基于待发送的数据和生成多项式计算出差错检测码（冗余码），将其添加到待传输数据的后面一起传输
> * 接收方通过生成多项式来计算收到的数据是否产生了误码

![多项式举例](  images\多项式举例.png)

![CRC过程](  images\CRC过程1.png)

![CRC题目讲解1](  images\CRC题目讲解1.png)

> 构造除数：
>
> 首先要知道CRC生成的多项式P（X）。除数的位数是P（X）最高次幂+1，从右往左分别为第0位1位2位3位4位···P（X）每个幂数代表着除数从右到左第几位为1，其余的都为0，比如P（X）= X^3+1就是第3位和第0位为1，其余都是0，即1001
>
> * 其中的做“除法”其实就是异或运算

![CRC题目讲解2](  images\CRC题目讲解2.png)

> * 检错码只能检测除帧在传输过程中出现了差错，但不能定位错误，因此无法纠正错误
> * 要想纠正传输中的差错，可以使用冗余信息更多的纠错码进行前向纠错，但纠错码的开销比较大，在计算机网络中较少使用
> * CRC有很好的检错能力（漏检率低），虽然计算比较复杂，但已于用硬件实现，因此被广泛应用于数据链路层
> * 在计算机网络中通常采用我们后续课程中讨论的检错重传的方式来纠正传输中的差错或者仅仅是丢弃检测到差错的帧，取决于数据链路层向其上层提供的是否是可靠传输服务

> 帧检测序列FCS
>
> * 仅用循环冗余检验CRC差错检测技术只能做到无差错接受
>   * 即分时接收端数据链路层接收端的帧无差错
>
> 传输差错
>
> * 比特差错
> * 比特差错：帧丢失，帧重复，帧失序等

## 可靠传输的基本概念

> * 使用差错检测技术（例如循环冗余校验CRC），接收方的数据链路层就可检测出帧在传输过程中是否产生了误码（比特错误）
> * 数据链路层向上层提供的服务类型
>   * 不可靠传输服务：仅仅丢弃有误码的帧，其他什么也不做
>   * 可靠传输：想办法实现发送端发送什么，接收端就收到什么
> * 一般情况下，有线链路的误码率比较低，为了减少开销，并不要求数据链路层向上提供可靠传输服务。即使出现了误码，可靠传输的问题由其上层处理
> * 无线链路易受干扰，误码率比较高，因此要求数据链路层必须向上层提供可靠传输服务
> * 比特差错只是传输差错中的一种
> * 从整个计算机网络体系结构来看，传输差错还包括分组丢失，分组失序和分组重复

### 其他传输差错

**分组丢失**

![分组丢失](  images\分组丢失.png)

>  路由器输入队列快满了，主动丢弃收到的分组                                                                                

**分组失序**

![分组失序](  images\分组失序.png)

> 数据未按照发送顺序依次到达接收端，可能就由于未走同一条线路造成

**分组重复**

> 由于某些原因有些分组在网络中滞留了，没有及时到达接收端，这可能造成发送端对该分组的重发，重发的分组到达，而在一段时间之后，滞留的分组也到达接收端，这就造成了分组重发的传输差错

> * 分组丢失，分组失序以及分组重复这些传输差错，一般不会出现数据链路层，而会出现在其上层
> * 可靠传输服务并不仅局限于数据链路层，其他各层均可选择实现可靠传输

![各层的可靠，不可靠传输](  images\各层的可靠，不可靠传输.png)

## 三种可靠协议

> * 停止-等待协议sw
> * 回退N帧协议GBN
> * 选择重传协议SR
>   * 这三种可靠传输实现机制的基本原理并不仅限于数据链路层，可以应用到计算机网络体系结构的各层协议中

## 停止-等待协议SW

![停止-等待协议sw](  images\停止-等待协议sw.png)

>  发送方给接收方发送数据分组，接收方收到后对其进行差错检测，若没有误码，则接受方接受该数据分组，并给发送方发送确认分组，简称ACK，发送方收到对所发送数据分组的确认分组后，才能发送下一个数据分组，假设在数据传输的过程中出现了误码，接收方收到后对其进行差错检测，发现了误码，则丢弃其发送来的数据分组，并给发送方发送否认分组，简称为NAK ，发送方收到对所发送数据分组的否认分组后，就知道了之前自己所发送的数据分组出现了差错被对方拒绝，于是重新传送该数据分组，因此，发送方每发送完一个分组之后，并不能立刻将该数据分组从缓存中删除，只有在收到针对该分组的确认分组信息后，才能将其从缓存中删除

###  超时重传![超时重传](  images\超时重传.png)

> 对于数据链路层点对点信道而言，不容易出现这种情况，但对于多个网络通过多个路由器连接的复杂互联网而言，就容易发生

### 分组编号

![确认丢失](  images\确认丢失.png)

> 当ACK丢失的时候，发送方就会再次发送同一个数据分组，当接收方收到数据分组的时候会发现数据分组是重复的就会丢弃，并且发送同一个数据分组的序号

### 确认迟到

![确认分组迟到](  images\确认分组迟到.png)

> 如图ACK0因某种原因接收迟到，由于超时重传，DATA0就会重传。但是迟来的ACK0又会使DATA1发送，如果没有数据分组编号，ACK0就会被误以为是ACK1
>
> * 对于数据链路层的点对点信道，往返时间比较固定，基本不会出现这种情况，所以可以不需要确认分组

### 小结

 ![停止等待协议SW小结](  images\停止等待协议SW小结.png)

### 停止等待协议的信道利用率

![停止等待协议SW的信道利用律](  images\停止等待协议SW的信道利用律.png)

> - **TD**：是发送方发送数据分组所耗费的发送时延
> - **RTT**：是收发双方之间的往返时间
> - **TA**：是接收方发送确认分组所耗费的发送时延
> - 图中忽略了接收方处理数据分组和发送方处理确认分组的时间
>
> TA一般都远小于TD，可以忽略，当RTT远大于TD时，信道利用率会非常低

![停止等待协议的习题](  images\停止等待协议的习题.png)

![sw的习题总结](  images\sw的习题总结.png)

## 回退N帧协议GBN

![回退N帧协议GBN](  images\回退N帧协议GBN.png)

> 在相同的时间内，停止——等待协议的发送只能发送一个数据分组，而采用流水线传输的发送方，可以发送多个数据分组

![回退N帧协议的过程](  images\回退N帧协议的过程.png)

> 无差错的基本过程：
>
> 发送方会维持一个发送窗口，序号落在发送窗口内的数据分组可被连续发送，而不必等收到接受方的相应确认分组后再发送，如图所示，序号落在发送窗口的5个数据分组可以连续发送，剩下的则不允许，在窗口的5个数据分组经过互联网的传输，到达接收方，在无差错的情况下，接收方按序接收他们，每接收一个，接收窗口就会向前滑动一个位置，并给发送方发送针对所接收分组的确认分组，当0—4的数据分组的确认分组到达发送方则发送窗口也向后移动窗口尺寸个位置，发送方就能将收到确认的数据分组从缓存中删除了
>
> * 接受窗口的尺寸只能为1

### 累计确认

![回退N帧协议累计确认](  images\回退N帧协议累计确认.png)

> 优点：
>
> * 即使确认分组丢失，发送方可能也不必重连
>   * 因为是累计确认，只要在无差错的情况下，ACKn范围内的都可能避免重连问题
> * 减小接收方的开销
> * 减小对网络资源的占用
>
> 缺点：
>
> * 不能向发送方即使反映出接收方已经正确接受的数据分组信息

### 回退N帧有差错的情况

>  在传输数据分组时，5号数据分组出现误码，接收方通过数据分组中的检错码发现了错误

![回退N帧差错1](  images\回退N帧差错1.png)

> 于是丢弃该分组，而后续到达的这剩下四个分组与接收窗口的序号不匹配

![回退N帧差错2](  images\回退N帧差错2.png)

> 接收方同样也不能接收他们，将他们丢弃，并对之前按序接收的最后一个数据分组进行确认，发送ACK4，每丢弃一个数据分组，就发送一个ACK4

![回退N帧差错3](  images\回退N帧差错3.png)

> 当收到重复的ACK4时，就知道之前所发送的数据分组出现了差错，于是可以不等超时计时器超时就立刻 开始重传，具体收到几个重复确认就立刻重传，根据具体实现决定

![回退N帧差错4](  images\回退N帧差错4.png)

> 如果收到这4个重复的确认并不会触发发送立刻重传，一段时间后。超时计时器超时后，也会将发送窗口已发送过的这些数据分组全部重传

![回退N帧差错5](  images\回退N帧差错5.png)

若Wt超过范围

![回退N帧Wt超过范围](  images\回退N帧Wt超过范围.png)

 ### 总结

![回退N帧总结](  images\回退N帧总结.png)

> * 回退N帧协议在流水线传输的基础上利用发送窗口来限制发送方连续发送数据分组的数量，是一种连续ARQ协议
> * 在协议的工作过程中发送窗口和接收窗口不断向前滑动，因此这类协议又称为滑动窗口协议
> * 由于退回N帧协议的特性，当通过新线路质量不好时，其信道利用率并不比停止-等待协议高

### 习题

![回退重传习题](  images\回退重传习题.png)

## 选择重传协议SR

 



![选择重传协议前提](  images\选择重传协议前提.png)

> 发送的0，1，3数据分组正常达到接收方，2号数据分组丢失

![选择重传协议SR1](  images\选择重传协议1.png)

> 只要序号落入接收窗口内且无误码的数据分组，接收方都会接收

![选择重传协议2](  images\选择重传协议2.png)

> 接收方接收0号和1号数据分组，并发送0号和1号确认分组，接收窗口向前滑动两个位置，这样就有4和5这两个新的序号落入接收窗口

![选择重传协议3](  images\选择重传协议3.png)

> 接受方接收3号数据分组，并发送3号确认分组，但窗口不能向前滑动，因为3号数据分组是未按序到达的数据分组

![选择重传协议4](  images\选择重传协议4.png)

> 这些确认分组经过互联网的传输陆续达到发送方，发送方每按序收到一个确认分组，发送窗口就向前滑动一个位置

![选择重传协议5](  images\选择重传协议5.png)

> 发送方接收0，1号数据分组的确认分组，发送窗口向前滑动两个位置，这样就有4和5这两个新的序号落入发送窗口，发送方将序号落入发送窗口的4号和5号数据分组发送出去

![选择重传协议6](  images\选择重传协议6.png)

> 发送方现在可以将已经收到确认的0号和1号数据分组，从发送缓存中删除了，而接收方可择机将以按序接收的0号和1号数据分组交付上层处理

![选择重传协议7](  images\选择重传协议7.png)

> 发送方接收3号确认分组，但发送窗口不能向前滑动，因为这是一个未按序到达的确认分组，发送方未收到它之前的2号确认分组，不过，需要记录3号数据分组已收到确认，这样该数据分组就不会超时重发，4，5号数据到达接受方

![选择重传协议8](  images\选择重传协议8.png)

>  接收方接收他们，并发送4号和5号确认分组，但接收窗口不能向前滑动，因为他们是未按序到达的数据分组，接收方还未收到他们之前的2号数据分组，假设在4号和5号确认分组的传输过程中，发送方针对2号数据分组的重传计时器超时了，发送方重传2号数据分组，4号和5号确认分组陆续到达发送方，发送方接收他们，并记录他们确认分组已收到确认，这样保证了不会超时重发

![选择重传协议10](  images\选择重传协议10.png)

> 发送方之前重传的2号数据分组到达接收方，接收方接收该数据分组，并发送确认分组，现在接收窗口可以往后移动4个位置

![选择重传协议11](  images\选择重传协议11.png)

> 2号确认分组经过互联网的传输到达发送方，发送方接收该确认分组，发送窗口就可以往前移动4个窗口

![选择重传协议12](  images\选择重传协议12.png)

### 发送窗口和接收窗口的尺寸问题

![选择重传协议窗口尺寸问题](  images\选择重传协议窗口尺寸问题.png)

> 如图所示，0号的确认帧丢失，当0号帧重发时接收方就无法区别是不是下一组的0号帧，导致出现分组重复这种传输差错

![选择重传协议窗口尺寸超出不合理原因](  images\选择重传协议窗口尺寸超出不合理原因.png)

### 总结

![选择重传协议总结](  images\选择重传协议总结.png)

## 点对点协议PPP

> * 点对点协议PPP（Point-to-Protocol）是目前使用最广泛的点对点数据链路层协议（1994年）
> * 是数据链路层使用的一种协议，它的特点是：简单；只检测差错，而不是纠正差错；不使用序号，也不进行流量控制；可同时支持多种网络协议

> 简单：首要要求
>
> 封装成帧：必须规定特殊的字符作为帧定界符
>
> 透明性：必须保证数据传输的透明性
>
> 多种网络协议：能够在同一条物理链路上同时支持多种网络层协议
>
> 多种类型链路：能够在多种类型的链路上运行
>
> 差错检测
>
> 检测连接状态：能够及时自动检测出链路层是否处于正常工作状态
>
> 最大传输单元：必须对每一种类型的点对点链路设置最大传送单元，
>
> 网络层地址协商：必须提供一种直接使通信的两个网络层实体能够通过协商知道或能够配置彼此的网络层地址
>
> 数据压缩协商

 ![点对点协议](  images\点对点协议.png)

> PPP协议为在点对点链路传输各种协议数据报提供了一个标准方法，主要由以下三部分组成：
>
> * 对各种协议数据报的封装方法（封装成帧）
> * 链路控制协议LCP 						用于建立、配置以及测试数据链路的连接
> * 一套网络控制协议NCPs         其中的每一个协议支持不同的网路层协议

### 帧格式![ppp协议帧格式](  images\ppp协议帧格式.png)

> 透明传输——面向字节的异步链路采用插入转义字符的字节填充法

![ppp协议透明传输](  images\ppp协议透明传输面向字节的异步链路.png)

> 透明传输——面向比特的同步链路采用插入比特0的比特填充法

![ppp协议透明传输面向比特流的同步链路](  images\ppp协议透明传输面向比特流的同步链路.png)

### 差错检测

![ppp协议差错检测](  images\ppp协议差错检测.png)

### 工作状态

![ppp协议工作状态](  images\ppp协议工作状态.png)

> * 当用户拨号接入ISP，路由器的调制解调器对拨号做出确认，并建立一条物理连接
> * PC机向路由器发送一系列的LCP分组（封装成多个PPP帧）
> * 这些分组及其相应选择一些PPP参数，并进行网络层配置，NCP给新接入的PC机分配一个IP主机，使PC机成为因特网上的一个主机
> * 通信完毕时，NCP释放网络层连接，收回原来分配出去的IP地址。接着LCP释放数据链路层连接。最后释放的是物理层的连接
>
> 可见，ppp协议已不是纯粹的数据链路层的协议，他还包含物理层和网络层的内容

> * 

## 媒体接入控制

### 基本概念

![媒体接入控制的基本概念](  images\媒体接入控制的基本概念.png)

> 如图，主机D与主机C同时使用总线来发送数据，导致所发送信号的碰撞
>
> * 共享信道要着重考虑的一个问题就是如何协调多个发送和接受站点对一个共享传输媒体的占用，即媒体接入控制MAC（Medium Access Control）

![ ](  images\媒体接入控制.png) 

> 随着技术的发展，交换技术的成熟葛成本的降低，具有更高性能的使用点对点链路葛链路层交换机的交换式局域网在有线领域已经完全取代了共享式局域网，但由于无线信道的广播天性，无线局域网仍然使用的是共享媒体技术

### 静态划分信道    

> * 复用（Multiplexing）是通信技术的一个重要概念。复用就是通过一条物理线路同时传输
>
> * 当网络中传输媒体的传输容量大于多条单一信道传输的总通信量时，可利用复用技术在一条物理线路上建立多条通信信道来充分利用传输媒体的带宽

![信道复用](  images\信道复用.png)

#### 频分复用FDM

![频分复用](  images\频分复用.png)

> 将传输线路的频带资源划分为多个子频带，各子信道之间需要留出隔离频带，以免造成子信道之间的干扰，当信号输入一个多路复用器时，这个复用器将每一路信号调制到不同频率的载波上，接收端由相应的分用器通过过滤波将各路信号分开，将合成的复用信号恢复成原始的多路信号
>
> * 频分复用的所有用户同时占用不同的频带资源并进行通信

####   时分复用TDM

![时分复用TDM](  images\时分复用TDM.png)

> * 按时隙轮流分配给不同的用户，每对用户只在所分配的时隙里使用线路传输数据
> * 时分复用技术将时间划分成了一段段等长的时分复用帧（TMD帧），如图所示每一个用户所占用的时隙时周期性出现的，其周期就是时分复用帧的长度
> * 时分复用的所有用户子啊不同的时间占用相同的频带宽度

#### 波分复用WDM

![波分复用WDM](  images\波分复用WDM.png)

> * 其实就是光的频分复用
> * 如图所示，这是8路传输速率均为2.5Gbit/s的光载波，其波长都为1310nm，经过光调制器后，分别将波长变换到1550-1561.2nm，每个光载波相隔1.6nm，这8葛波长很接近的光载波经过光复用器（合波器），就在一根光纤中传输，因此在光纤中的传输速率就变成了8*2.5Gbit\s=20Gbit\s
> * 光信号传输一段距离后就会衰减，因此必须对衰减了的光信号进行放大才能继续传输，现在已经有了很好的掺铒光纤放大器，   两个光纤放大器之间的光缆线路长度可达120km                                

#### 码分复用CDMA

> * 在CDMA中，每一个比特时间在划分为m个短的间隔，称为`码片`（chip）。通常m的值是64或128.为了简单起见，在后续中。我们假设m为8
>
> * 使用CMDA的每一个站被指派一个`唯一的m bit码片序列`（Chip Sequence）
>
>   * 一个站如果要发送比特1，则发送它自己的 m bit码片序列；
>   * 一个站如果要发送比特0，则发送它自己的m bit码片序列的二进制反码
>
>   举例： 
>
>   * 指派给CDMA系统中某个站点的码片序列为 0011011
>   * 发送比特1：发送自己的码片序列 00011011
>   * 发送比特0： 发送自己的码片序列的二进制反码 11100100
>   * 为了方便，我们将按惯例将码片序列中的0写为-1，将1写为+1
>   * 则该站点的码片序列为（-1 -1 -1 +1 +1 -1 +1 +1）
>   * 这种方式称为`直接序列扩频DSSS`         
>
> * 码片序列的挑选原则如下
>
>   * 分配给每个站的码片序列必须相互正交（规格化内积为0）
> * ![码片序列的挑选原则](  images\码片序列的挑选原则.png)
>   
>   * ![码片序列习题](  images\码片序列习题.png)
> * ![码片序列举例](  images\码片序列举例.png)



> * 该技术主要用于多址接入，人们更常用的名词是码分多址CDMA（Code Division Multiple Access）
> * 同理，频分复用和时分复用同样用于多址接入，相应的名词是频分多址FMDA（Frequency Division Multiple Access）和时分多址TDMA（Time Division Multiple Access）
> * 与FDM和TDM不同，CDM的每一个用户可以在同样的时间使用同样的频带进行通信
> * 由于各用户使用经过特殊挑选的不同码型，因此在个用户之间不会造成干扰
> * CDM最初是用于军事通信的，因为这种系统所发送的信号有很强的抗干扰能力， 其频谱类似于白噪声

### 复用与多址

> * 复用是将单一媒体的频带资源划分为很多子信道，这些子信道之间相互独立，互不干扰。从媒体的整体频带资源上看，每个子信道只占用该媒体频带资源的一部分
> * 多址（更确切地应该称为多点接入）处理的是动态分配信道给用户，这在用户仅仅暂时性的占用信道的应用中是必须的，而所有的移动通信系统基本上都属于这种情况。相反，在信道永久性地分配给用户的应用中，多址是不需要的（对于无线广播或电视广播站就是这样）                

### 动态接入控制

#### 随机接入

##### CSMA/CD协议

早期的共享式以太网，采用载波监听多址接入/碰撞检测CSMA/CD(Carrier Sense Multip Access/Collision Detection)

>  因为最初的以太网是将许多计算机都连接到一根总线上（即总线局域网）。易于实现广播通信，当初认为这样的连接方法既简单又可靠，因为总线上没有有源器件
>
> 以太网采用无连接的工作方式，对发送的数据帧不进行编号，也不要求对方发回确认。目的站收到有差错的帧就把它丢掉，其他什么都不做

> 多址接入MA
>
> * 多个站连接在一条总线上，竞争使用总线
>
> 
>
> 载波监听CS
>
> * 
>
> 碰撞检测CD
>
> * 每一个正在发送帧的站边发送边检测碰撞（“边说边听”）
>   * 一旦发现总线上出现碰撞，则立刻停止发送，退避一段随机时间后子啊次发送（“一旦冲突，立即停说，等待时机，重新再说”）

###### 多址接入MA

> 表示许多主机以多点接入的方式连接在一根总线上，竞争使用总线

![多址接入MA](  images\多址接入MA.png)

###### 载波监听CS

> 每个站在发送帧之前先要检测一下总线是否有其他站点在发送帧（“先听后说”）
>
> * 若检测到总线空闲96比特时间，则发送这个帧
> * 若检测到总线忙，则继续检测并等待总线转为空闲96比特时间，然后发送这个帧
>   * 96比特时间是指发送96比特所耗费的时间，也称为帧间最小间隔，其作用是使接收方可以检测出一个帧的结束，同时使所有其他站点都能有机会平等竞争信道并发送帧
> * 总线上并没有什么“载波”。因此，“载波监听”就是用电子技术检测总线上有没有其他计算机发送的数据信号

![载波监听CS](  images\载波监听CS.png)

###### 碰撞检测CD

> * “碰撞检测”就是计算机边发送数据边检测信道上的信号电压大小
> * 当几个站同时在总线上发送数据时，总线上的信号电压摆动值就会增大{相互叠加}
> * 当一个站检测到信号电压摆动值超过一定的门限值时，就会认为总线上至少有两个站同时在发送数据，表明产生了碰撞
> * 所谓"碰撞"就是发生了冲突。因此“碰撞检测”也称为“冲突检测”
> * 在发生碰撞时，总线上传输的信号产生了严重的失真，无法从中恢复出有用的信息来
> * 每一个正在发送数据的站，一旦发现总线上出现了碰撞，就要立即停止发送，免得继续浪费网络资源，然后等待一段随机时间后再次发送

![碰撞检测CD](  images\碰撞检测CD.png)

> 碰撞检测的必要
>
> * 是因为信号传播时延对载波监听产生了影响
>
> ![信号传播时延对载波监听的影响](  images\信号传播时延对载波监听的影响.png)
>
> * 结论就是A需要单程传播时延的2倍的时间，才能检测到与b的发送产生了冲突

###### CSMA/CD协议——争用期（碰撞窗口）

![争用期（碰撞窗口）](  images\争用期（碰撞窗口）.png)

> 对于**最大长度为2500米的10Mbps 网络和四个中继器**（来自802.3规范），在最坏的情况下，往返时间（包括通过四个中继器的传播时间）被确定为接近**50微秒**。因此，允许的最短帧必须至少花费这么长的时间来传输。在10Mbps时，一个比特需要100纳秒，所以500比特是保证工作的最小帧。为了增加一些安全边际，这个数字被四舍五入到**512比特即64字节**，相应的，以太网的争用期长度也被确定为**51.2 μs**
> 链接：https://www.zhihu.com/question/21882019/answer/1801210673

###### CSMA/CD协议——最小帧长

![最小帧长](  images\最小帧长.png)

>  为了实现CSMA/CD,需要限定帧的长度。在发送帧的最后一位前，发送站点必须检测冲突，如有任何冲突都要放弃传输。这是因为一旦整个帧被被发送了，站点就无法保留帧的副本并无法掌控线路中的冲突检测。因此，帧的传输时间Tfr必须至少是**最长传播时间Tp的2倍。**

###### CSMA/CD协议——最大帧长

![最大帧长](  images\最大帧长.png)

> * 一直占用总线
> * 接收的站的缓冲区可能溢出 

###### CSMA/CD协议——截断二进制指数退避算法

![截断二进制指数退避算法](  images\截断二进制指数退避算法.png)

###### CSMA/CD协议——信道利用率

![CSMA,CD信道利用率](  images\CSMA,CD信道利用率.png)

###### CSMA/CD协议——流程图

**帧发送流程**

![CSMA，CD帧发送流程](  images\CSMA，CD帧发送流程.png)

**帧接收流程**

![CSMA，CD帧接收流程](  images\CSMA，CD帧接收流程.png)

###### 重要特性

> * 使用CSMA/CD协议的以太网不能进行全双工通信只能进行双向交替通信（半双工通信）
> * 每个站在发送数据之后的一小段时间内，存在着遭遇碰撞的可能性
> * 这种发送的不确定性使整个以太网的平均通信量远小于以太网的最高数据率
> * CSMA/CD协议曾用于各种总线结构以太网和双绞线以太网的早期版本中
> * 现在的以太网基于交换机和全双工连接，不会有碰撞，因此没有必要使用CSMA/CS协议

###### 习题

![CSMA，CD协议习题1](  images\CSMA，CD协议习题1.png)

> 公式推到原理是： 帧的传输时间Tfr必须至少是**最长传播时间Tp的2倍。**

##### CSMA/CA协议

> 即载波监听多址接入/碰撞避免CSMA/CA（Carrier Sense Multiple Access/Collision Avoidance）

![CSMA、CA协议](  images\CSMA、CA协议.png)

###### 使用的必要性

> 在无线局域网中，不能使用碰撞检测CD，原因如下
>
> * 由于无线信道的传输条件特殊，其信号强度的动态范围非常大，无线网卡上接收到的信号强度往往会远远小于发送信号的强度，可能相差百万倍，如果要在无线网卡上实现碰撞检测CD，对硬件的要求非常高
> * 即使能够在硬件上实现无线局域网的碰撞检测功能，但由于无线电波传播的特殊性（存在）

![CSMA、CA的必要性](  images\CSMA、CA的必要性.png)

######  帧间间隔

  ![CSMA、CA帧间间隔](  images\CSMA、CA帧间间隔.png)

######  工作原理

![CSMA、CA工作原理](  images\CSMA、CA工作原理.png)

> 源站为什么在检测到信道空闲后还要在等待一段时间DIFS
>
> * 考虑到可能有其他的站有高优先级的帧要发送，
>
> 目的站为什么正确接收数据帧后嗨哟啊等待一段时间SIFS才能发送ACK帧
>
> * SIFS是最短的帧间间隔，用来分隔开属于一次对话的各帧，在这段时间内，一个站点应当能够从发送方式切换到接收方式

###### 退避算法

![CSMA、CA退避算法应用实例](  images\CSMA、CA退避算法应用实例.png)

> * 当占地那检测到信道是空闲的，并且所发送的数据帧不是成功发送玩上一个数据帧之后立即连续发送的数据帧，则不使用退避算法
> * 一下情况必须使用退避算法
>   * 在发送数据帧之前检测到信道处于忙状态时；
>   * 在每一次重传一个数据帧时；
>   * 在每一次成功发送后要连续发送下一个帧时（这是为了避免一个站点长时间占用信道）

> * 在执行退避算法时，站点为退避计时器设置一个随机的退避时间
>   * 当退避计时器的时间减小到零时，就开始发送数据；
>   * 当退避计时器的时间还未减小到零时而信道又转变为忙状态，这是就冻结退避计时器的数值，重新等待信道变为空闲后，在经过时间DIFS后，继续启动退避计时器
> * ![CSMA、CA退避算法](  images\CSMA、CA退避算法.png)

###### 信道预约和虚拟载波监听

  ![信道预约](  images\信道预约.png)

![信道预约1](  images\信道预约1.png)

> * 除RTS帧和CTS帧会携带通信持续的时间，数据帧也能携带通信需要持续的时间，这就称为802.11的虚拟载波监听机制
> * 由于利用虚拟载波监听机制，站点只要监听到RTS帧、CTS帧或数据帧的其中一个，就能知道信道被占用的持续时间，而不需要真正监听到信道上的信号，因此虚拟载波监听机制能减少隐蔽站带来的碰撞问题

![虚拟载波监听机制减少隐蔽站带来的问题](  images\虚拟载波监听机制减少隐蔽站带来的问题.png)

## MAC概述

> MAC(Media Access Control, 介质访问控制)，或称为 MAC位址、硬件位址，用来定义网络设备的位置。在OSI模型中，第三层网络层负责 IP地址，第二层数据链路层则负责 MAC位址。因此一个主机会有一个IP地址，而每个网络位置会有一个专属于它的MAC位址。MAC地址，用来表示互联网上每一个站点的标识符，采用十六进制数表示，共六个字节(48位)。其中，前三个字节是由IEEE的注册管理机构RA负责给不同厂家分配的代码(高位24位)，也称为“编制上唯一的标识符”(Organizationally Unique Identifier)，后三个字节(低位24位)由各厂家自行指派给生产的适配器接口，称为扩展标识符(唯一性)。一个地址块可以生成2^24个不同的地址。MAC地址实际上就是适配器地址或适配器标识符EUI-48。

